<?xml version="1.0" encoding="UTF-8"?>  
    <!DOCTYPE mapper  
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
          "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yuzhaibu.dao.ItemDao">

	
	<resultMap type="com.yuzhaibu.entity.Item" id="itemAndUserMap">
		<id property="itemid" column="itemid"></id>
		<result property="itemname" column="itemname" />
		<result property="sellprice" column="sellprice" />
		<result property="itemmainimg" column="itemmainimg" />
		<association property="usernormal" javaType="com.yuzhaibu.entity.User_normal">
			<id property="uernormal_id" column="usernormal_id" />
			<result property="school" column="school" />
			<result property="authen" column="authen" />
		</association>
	</resultMap>

	<select id="findItemByUserId" parameterType="java.util.Map"
		resultType="com.yuzhaibu.entity.Item">
		select * from item where sellerid=#{sellerid} order by itemcreatime desc limit #{index},#{pageSize} ;
	</select>
	<select id="findItemByUserIdCount" parameterType="java.util.Map" resultType="int">
		select count(1) from item where sellerid=#{sellerid} order by itemcreatime desc ;
	</select>

	<select id="findIndexItemByClassId" parameterType="int"
		resultMap="itemAndUserMap">
		select itemid,itemname,sellprice,itemmainimg,school,authen
		from item i,user_normal u,itemclass ic where
		i.sellerid=u.usernormal_id and sellstatus=0 and
		ic.itemclass_fatherid=#{classid} and ic.itemclass_id=i.itemclassid
		order by itemcreatime desc 
		limit 0,6
		;
	</select>


	<select id="findItemByItemId" parameterType="int"
		resultType="com.yuzhaibu.entity.Item">
		select * from item where itemid = #{itemid}
	</select>

	<select id="findOtherItemByUserId" parameterType="int"
		resultType="com.yuzhaibu.entity.Item">
		select itemid,itemmainimg,itemname FROM item where sellerid
		= #{userid} and sellstatus=0 order by viewtime desc limit 0,4;
	</select>

	<select id="findItemListFatherItemByFatherId" parameterType="java.util.Map"
		resultType="com.yuzhaibu.entity.Item">
		select * from item i,itemclass it where
		it.itemclass_fatherid=#{fid} and i.itemclassid=it.itemclass_id and
		sellstatus!=2 	
		<if test="order==null">
			order by i.viewtime
		</if>	
		<if test="order=='0'.toString()">
			order by i.sellprice desc
		</if> 
		<if test="order=='1'.toString()">
			order by i.sellprice asc
		</if> 
		<if test="order=='2'.toString()">
			order by i.itemcreatime desc
		</if> 
		<if test="order=='3'.toString()">
			order by i.itemcreatime asc
		</if> 
		limit #{index},#{pageSize};
	</select>
	
	<select id="countItemByFatherId" parameterType="int" resultType="int">
		select count(i.itemid) from item i,itemclass it where it.itemclass_fatherid=#{fid} and i.itemclassid=it.itemclass_id and
		sellstatus!=2 
	</select>

	<select id="findItemListByClassId" parameterType="int"
		resultType="com.yuzhaibu.entity.Item">
		select * from item i where itemclassid=#{id} and
		sellstatus!=2 
		<if test="order==null">
			order by i.viewtime
		</if>	
		<if test="order=='0'.toString()">
			order by i.sellprice desc
		</if> 
		<if test="order=='1'.toString()">
			order by i.sellprice asc
		</if> 
		<if test="order=='2'.toString()">
			order by i.itemcreatime desc
		</if> 
		<if test="order=='3'.toString()">
			order by i.itemcreatime asc
		</if> 
		limit #{index},#{pageSize};
	</select>
	
	<select id="countItemById" parameterType="int" resultType="int">
		select count(itemid) from item where itemclassid = #{id} and
		sellstatus!=2 
	</select>

	<insert id="insertNewItem" parameterType="com.yuzhaibu.entity.Item" useGeneratedKeys="true" keyProperty="itemid">
		insert into item
		(itemname,sellprice,originprice,color,tradeposition,sellerid,itemcreatime,bargain,discreption,sellstatus,itemclassid)
		values(#{itemname},#{sellprice},#{originprice},#{color},#{tradeposition},#{sellerid},now(),#{bargain},#{discreption},0,#{itemclassid})
	</insert>
	
	<update id="updateMainImg" parameterType="java.util.Map">
		update item
		set itemmainimg = #{mainimg}
		where itemid = #{id}
	</update>
	
	<update id="updateViewTimes" parameterType="int">
		update item
		set viewtime = viewtime+1
		where itemid = #{itemid}
	</update>
	
	<select id="findItemCountByUseridAndItemId" parameterType="java.util.Map" resultType="int">
		select count(1) from item where itemid = #{itemid} and sellerid= #{userid}
	</select>
	
	<update id="editItem" parameterType="com.yuzhaibu.entity.Item">
		update item
		set 
		itemname = #{itemname},
		sellprice = #{sellprice},
		originprice = #{originprice},
		color = #{color},
		tradeposition = #{tradeposition},
		bargain = #{bargain},
		discreption = #{discreption}
		where itemid = #{itemid}
		
	</update>

</mapper>